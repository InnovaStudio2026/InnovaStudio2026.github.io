<!DOCTYPE html>
<html lang="es">
<head>
<!-- jsPDF AutoTable (para tablas nativas en PDF) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <meta charset="UTF-8" />
    <title>Prueba de Sociales</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            font-size: 20px;
            background: linear-gradient(to bottom right, #0a2c58, #ffffff);
            color: #333;
        }
        header {
            background: url('https://grupogeard.com/co/wp-content/uploads/sites/3/2020/07/Blog-saber-11.jpg') no-repeat center center;
            background-size: cover;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        header h1 {
            font-size: 2rem;
            background-color: rgba(0, 0, 0, 0.4);
            padding: 10px 30px;
            border-radius: 12px;
        }
        .contenedor {
            background-color: #ffffff;
            margin: 20px auto;
            padding: 20px;
            border-radius: 16px;
            max-width: 800px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        /* ESTILO PARA PREGUNTAS */
        .contenedor.pregunta {
            background-color: rgba(173, 216, 230, 0.8);
            margin-top: 10px;
            font-size: 18px;
            border-radius: 16px;
            padding: 15px 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        /* Estilo para contenedor puntuaci√≥n */
        .contenedor.puntuacion {
            background-color: rgba(173, 216, 230, 0.8);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            color: #000;
        }

        .flex {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            align-items: center;
        }
        .flex > div {
            display: flex;
            flex-direction: column;
            margin-right: 20px;
        }
        label {
            display: block;
            margin: 4px 0;
        }
        input[type="text"],
        input[type="number"], 
        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #bbb;
            min-width: 200px;
            font-size: 14px;
            background-color: #f8fbff;
        }
        input[type="radio"] {
            margin-right: 6px;
            transform: scale(1.5);
        }
        button {
            background: linear-gradient(to right, #6fa4d6, #1872e0);
            color: black;
            padding: 12px 28px;
            border: none;
            font-size: 17px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        button:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
        }
        
        /* MODAL DE RESULTADOS SUPER MODERNO (NEUMORFISMO) */
        #resultadoModal {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #e0f2ff; /* Color muy sutil */
            border-radius: 25px; 
            padding: 40px 50px; 
            z-index: 1000;
            text-align: center;
            animation: fadeIn 0.4s ease-out;
            font-size: 16px;
            color: #0a2c58; 
            font-weight: bold;
            max-width: 450px;
            width: 90%;
            /* Efecto Neum√≥rfico: Sombra suave que le da profundidad */
            box-shadow: 10px 10px 30px #a3c3e2, /* Sombra oscura para profundidad */
                        -10px -10px 30px #ffffff; /* Sombra clara para relieve */
        }
        #resultadoModal h2 {
            color: #0a2c58;
            font-size: 28px;
            margin-bottom: 25px;
            font-weight: 900;
            /* Linea moderna sutil */
            border-bottom: 3px solid #4a90e2; 
            padding-bottom: 15px;
        }
        #resultadoModal p {
            margin: 10px 0;
            text-align: left;
            font-size: 16px;
            color: #333;
        }
        #resultadoModal p strong {
            color: #1872e0; /* Color azul m√°s brillante */
        }
        /* Estilo para destacar la NOTA */
        #resPuntaje {
            background-color: #f0f8ff; /* Fondo blanco sutil */
            color: #0a2c58;
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0 40px 0;
            font-size: 22px;
            font-weight: bolder;
            line-height: 1.5;
            /* Sombra interior para hacerlo parecer "presionado" */
            box-shadow: inset 5px 5px 10px #bfd7f0,
                        inset -5px -5px 10px #ffffff;
        }

        #resultadoModal button {
            /* Bot√≥n de cierre que tambi√©n usa estilo neum√≥rfico */
            background: #dc3545;
            color: white;
            padding: 12px 30px;
            font-size: 17px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 8px #a3c3e2, 
                        -4px -4px 8px #ffffff;
            font-weight: bold;
        }
        #resultadoModal button:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 6px 6px 12px #a3c3e2, 
                        -6px -6px 12px #ffffff;
        }
        #resultadoModal button:active {
            /* Efecto de "presionado" */
            transform: translateY(1px);
            box-shadow: inset 2px 2px 5px #7a2a32,
                        inset -2px -2px 5px #ff5d6d;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to¬† ¬†{ opacity: 1; transform: translate(-50%, -50%); }
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        #temporizador {
            position: fixed;
            top: 50px;
            left: 10px;
            background: #0a2c58;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: sans-serif;
            z-index: 9999;
            cursor: move;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.4);
            font-size: 14px;
        }
        #modalTiempoFuera {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            padding: 20px;
            display: none;
        }
        #modalTiempoFuera > div {
            background: rgba(255,255,255,0.1);
            border: 2px solid #fff;
            padding: 30px 40px;
            border-radius: 16px;
            backdrop-filter: blur(6px);
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
        }
        #btn-volver {
            position: fixed;
            bottom: 60px;
            left: 20px;
            z-index: 1000;
            padding: 12px 28px;
            background: linear-gradient(135deg, #0033cc, #0099ff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
        }
        #btn-volver:hover {
            background: linear-gradient(135deg, #002db3, #007acc);
            transform: scale(1.07);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.35);
        }
        #btn-volver:active {
            transform: scale(0.96);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.25);
        }
        @media (max-width: 500px) {
            .cuadro h2 {
                font-size: 18px;
            }
            .boton {
                font-size: 15px;
                padding: 9px 15px;
            }
            #btn-volver {
                font-size: 13px;
                padding: 10px 22px;
            }
        }
    </style>
</head>
<body onload="inicializarPrueba()">

    <button id="btn-volver" onclick="location.href='menu.html'">‚Æú Volver</button>


<div id="temporizador">Tiempo restante: 00:00</div>

<header>
    <h1>Prueba de Sociales</h1>
</header>

<div class="contenedor">
    <div class="flex">
        <div>
            <label><strong>C√≥digo de Identificaci√≥n (3 d√≠gitos):</strong></label>
            <input type="number" id="codigoEstudiante" min="101" max="105" maxlength="3" required>
        </div>
        
        <div>
            <label><strong>Nombre del Estudiante:</strong></label>
            <input type="text" id="nombreEstudiante" required>
        </div>

        <div>
            <label><strong>Grado:</strong></label>
            <select id="gradoEstudiante" required>
                <option value="">Seleccione</option>
                <option value="6-1">6-1</option>
                <option value="6-2">6-2</option>
                <option value="7-1">7-1</option>
                <option value="7-2">7-2</option>
                <option value="8-1">8-1</option>
                <option value="8-2">8-2</option>
                <option value="9-1">9-1</option>
                <option value="9-2">9-2</option>
                <option value="10-1">10-1</option>
                <option value="10-2">10-2</option>
                <option value="11¬∞">11¬∞</option>
            </select>
        </div>
    </div>
</div>

<div class="contenedor pregunta" id="q-1">
    <p><strong>1. ¬øQu√© hecho marc√≥ el inicio formal de la Segunda Guerra Mundial?</strong></p>
    <label><input type="radio" name="q1" value="a"> El ataque japon√©s a China</label>
    <label><input type="radio" name="q1" value="b"> La ocupaci√≥n alemana de Austria</label>
    <label><input type="radio" name="q1" value="c"> La invasi√≥n alemana de Polonia</label>
</div>

<div class="contenedor pregunta" id="q-2">
    <p><strong>2. ¬øCu√°l de las siguientes combinaciones representa a las Potencias del Eje?</strong></p>
    <label><input type="radio" name="q2" value="a"> Alemania, Jap√≥n e Ir√°n</label>
    <label><input type="radio" name="q2" value="b"> Alemania, Italia y Jap√≥n</label>
    <label><input type="radio" name="q2" value="c"> Alemania, Hungr√≠a y Finlandia</label>
</div>

<div class="contenedor pregunta" id="q-3">
    <p><strong>3. ¬øCu√°l fue uno de los efectos inmediatos en Europa tras la guerra?</strong></p>
    <label><input type="radio" name="q3" value="a"> Uni√≥n econ√≥mica entre pa√≠ses europeos</label>
    <label><input type="radio" name="q3" value="b"> Reconstrucci√≥n paulatina con el Plan Marshall</label>
    <label><input type="radio" name="q3" value="c"> Migraci√≥n masiva hacia Am√©rica</label>
</div>

<div class="contenedor pregunta" id="q-4">
    <p><strong>4. ¬øQu√© caracteriza al Holocausto dentro del conflicto mundial?</strong></p>
    <label><input type="radio" name="q4" value="a"> Desplazamiento de miles de soldados en Europa</label>
    <label><input type="radio" name="q4" value="b"> Muerte de millones de ciudadanos jud√≠os en campos de exterminio</label>
    <label><input type="radio" name="q4" value="c"> Uso de armas qu√≠micas en batallas urbanas</label>
</div>

<div class="contenedor pregunta" id="q-5">
    <p><strong>5. ¬øQu√© ocurri√≥ con Alemania al finalizar la guerra?</strong></p>
    <label><input type="radio" name="q5" value="a"> Se convirti√≥ en una rep√∫blica democr√°tica unificada</label>
    <label><input type="radio" name="q5" value="b"> Fue dividida entre las potencias vencedoras en dos estados distintos</label>
    <label><input type="radio" name="q5" value="c"> Se anex√≥ a la Uni√≥n Sovi√©tica</label>
</div>

<div class="contenedor pregunta" id="q-6">
    <p><strong>6. ¬øEntre qu√© a√±os se desarroll√≥ la Segunda Guerra Mundial?</strong></p>
    <label><input type="radio" name="q6" value="a"> 1939 a 1945</label>
    <label><input type="radio" name="q6" value="b"> 1932 a 1938</label>
    <label><input type="radio" name="q6" value="c"> 1940 a 1948</label>
</div>

<div class="contenedor pregunta" id="q-7">
    <p><strong>7. ¬øQu√© efecto geopol√≠tico tuvo la guerra mundial?</strong></p>
    <label><input type="radio" name="q7" value="a"> Disoluci√≥n de la ONU</label>
    <label><input type="radio" name="q7" value="b"> Creaci√≥n de la Uni√≥n Europea</label>
    <label><input type="radio" name="q7" value="c"> Inicio de un mundo bipolar entre EE.UU. y la URSS</label>
</div>

<div class="contenedor pregunta" id="q-8">
    <p><strong>8. ¬øCu√°l de los siguientes tratados fue una causa profunda del conflicto?</strong></p>
    <label><input type="radio" name="q8" value="a"> Tratado de Viena</label>
    <label><input type="radio" name="q8" value="b"> Tratado de Versalles</label>
    <label><input type="radio" name="q8" value="c"> Tratado de Ginebra</label>
</div>

<div class="contenedor pregunta" id="q-9">
    <p><strong>9. ¬øQu√© definici√≥n se dio en la gu√≠a sobre ‚Äúevaluar‚Äù?</strong></p>
    <label><input type="radio" name="q9" value="a"> Comparar hechos hist√≥ricos sin juicio de valor</label>
    <label><input type="radio" name="q9" value="b"> Establecer el valor o significado seg√∫n criterios definidos</label>
    <label><input type="radio" name="q9" value="c"> Memorizar informaci√≥n para aplicar en ex√°menes</label>
</div>

<div class="contenedor pregunta" id="q-10">
    <p><strong>10. ¬øCu√°l fue una repercusi√≥n tecnol√≥gica del conflicto?</strong></p>
    <label><input type="radio" name="q10" value="a"> Creaci√≥n del radar naval</label>
    <label><input type="radio" name="q10" value="b"> Desarrollo de la energ√≠a at√≥mica</label>
    <label><input type="radio" name="q10" value="c"> Invenci√≥n de la telefon√≠a m√≥vil</label>
</div>

<div class="contenedor puntuacion">
    <div id="alerta" style="display:none; color: white; background-color: #d9534f; padding: 10px; margin: 15px auto; width: 80%; border-radius: 8px; text-align: center; font-weight: bold;">
    </div>
    <button onclick="mostrarResultado()">Finalizar Prueba y Ver Nota</button>
</div>

<div id="resultadoModal">
    <h2>Resultado del Examen</h2>
    <p id="resNombre"></p>
    <p id="resGrado"></p>
    <p id="resCodigo"></p> 
    <p id="resFecha"></p>
    <p id="resHoraInicio"></p>
    <p id="resHoraFin"></p>
    <p id="resPuntaje"></p> 
    
   
    <button onclick="cerrarModal()">Cerrar</button>
</div>

<div id="modalTiempoFuera">
    <div>
        <h2 style="font-size: 28px; margin-bottom: 10px;">‚è∞ ¬°Se acab√≥ el tiempo!</h2>
        <p style="font-size: 18px;">La prueba se reiniciar√° en <span id="cuentaRegresiva">5</span> segundos...</p>
    </div>
</div>

<script>
    const VALOR_POR_PREGUNTA = 0.5; // Cada pregunta vale 0.5 puntos
    
    // Lista de c√≥digos v√°lidos para que concuerde con resultados_docente.html
    const CODIGOS_VALIDOS = ['101', '102', '103', '104', '105'];

    let tiempoPorPregunta = 50; // 50 segundos por pregunta
    let totalTiempoPermitido = 0;
    let tiempoUsado = 0;
    let timer;
    let horaInicio; // Variable global para la hora de inicio

    // Funci√≥n gen√©rica para barajar arrays (se mantiene)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function inicializarPrueba() {
        registrarInicio();
        aleatorizarTodo();
        calcularTiempoTotal();
        iniciarTemporizador();
        hacerTemporizadorMovible();
    }

    function registrarInicio() {
        const ahora = new Date();
        horaInicio = ahora.toLocaleTimeString(); // Guarda la hora de inicio
    }

    function calcularTiempoTotal() {
        const totalPreguntas = document.querySelectorAll('.contenedor.pregunta').length;
        totalTiempoPermitido = totalPreguntas * tiempoPorPregunta;
    }

    function iniciarTemporizador() {
        clearInterval(timer);
        tiempoUsado = 0;
        const display = document.getElementById('temporizador');

        timer = setInterval(() => {
            tiempoUsado++;

            const restante = totalTiempoPermitido - tiempoUsado;
            const minutos = Math.floor(restante / 60);
            const segundos = restante % 60;
            const tiempoTexto = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
            display.textContent = `Tiempo restante: ${tiempoTexto}`;

            if (restante <= 0) {
                clearInterval(timer);
                mostrarModalTiempoAgotado();
            }
        }, 1000);
    }

    function mostrarModalTiempoAgotado() {
        const modal = document.getElementById('modalTiempoFuera');
        const cuenta = document.getElementById('cuentaRegresiva');
        modal.style.display = 'flex';

        document.querySelectorAll('input, select, button[onclick="mostrarResultado()"]').forEach(el => el.disabled = true);

        let segundos = 5;
        cuenta.textContent = segundos;

        const countdown = setInterval(() => {
            segundos--;
            cuenta.textContent = segundos;
            if (segundos <= 0) {
                clearInterval(countdown);
                location.reload(); 
            }
        }, 1000);
    }

    function aleatorizarTodo() {
        const preguntas = Array.from(document.querySelectorAll(".contenedor.pregunta"));
        const quizArea = document.querySelector('body'); 
        const referenceNode = document.querySelector('.contenedor.puntuacion');

        if (!preguntas.length || !referenceNode) return;

        // 1. Aleatorizar Opciones dentro de cada pregunta
        preguntas.forEach(p => {
            const opciones = Array.from(p.querySelectorAll("label"));
            shuffleArray(opciones);
            opciones.forEach(op => p.appendChild(op));
        });

        // 2. Aleatorizar el orden de las Preguntas
        shuffleArray(preguntas);

        // 3. Reinsertar las preguntas en el DOM y Renumerar
        preguntas.forEach((p, index) => {
            const pTexto = p.querySelector("p strong");
            if (pTexto) {
                let newText = pTexto.textContent.replace(/^\d+\.\s*/, `${index + 1}. `);
                pTexto.textContent = newText;
            }
            quizArea.insertBefore(p, referenceNode);
        });
    }

    function mostrarResultado() {
        const nombre = document.getElementById("nombreEstudiante").value.trim();
        const grado = document.getElementById("gradoEstudiante").value;
        const codigo = document.getElementById("codigoEstudiante").value.trim();

        // 1. VALIDACIONES (Asegura que no haya campos vac√≠os y que el c√≥digo sea v√°lido)
        if (nombre === "") {
            alert("Por favor, ingrese el nombre del estudiante.");
            return;
        }

        if (grado === "" || grado === "Seleccione") {
            alert("Por favor, seleccione el grado.");
            return;
        }
        
        if (!CODIGOS_VALIDOS.includes(codigo)) {
            alert(`El C√≥digo de Identificaci√≥n "${codigo}" no es v√°lido. Debe ser uno de los c√≥digos pre-inscritos: ${CODIGOS_VALIDOS.join(', ')}.`);
            return;
        }

        const totalPreguntas = document.querySelectorAll(".contenedor.pregunta").length;

        for (let i = 1; i <= totalPreguntas; i++) {
            if (!document.querySelector(`input[name="q${i}"]:checked`)) {
                alert(`Por favor, responda todas las preguntas.`);
                return;
            }
        }

        // 2. C√ÅLCULO DE PUNTAJE Y NOTA
        const respuestas = {
            q1: "c", q2: "b", q3: "b", q4: "b", q5: "b",
            q6: "a", q7: "c", q8: "b", q9: "b", q10: "b"
        };

        let respuestasCorrectas = 0;
        for (let i = 1; i <= totalPreguntas; i++) {
            const seleccionada = document.querySelector(`input[name="q${i}"]:checked`);
            if (seleccionada?.value === respuestas[`q${i}`]) {
                respuestasCorrectas++;
            }
        }
        
        const notaFinal = (respuestasCorrectas * VALOR_POR_PREGUNTA).toFixed(1);

        const ahora = new Date();
        const horaFin = ahora.toLocaleTimeString();
        const fecha = ahora.toLocaleDateString();
        const horaInicio_display = horaInicio || 'N/A'; // Asegura que no sea undefined

        // 3. MOSTRAR RESULTADO EN MODAL (Muestra todos los campos que se guardar√°n)
        document.getElementById("resNombre").innerHTML = `üë§ <strong>Estudiante:</strong> ${nombre}`;
        document.getElementById("resGrado").innerHTML = `üéì <strong>Grado:</strong> ${grado}`;
        document.getElementById("resCodigo").innerHTML = `üÜî <strong>C√≥d. Identificaci√≥n:</strong> ${codigo}`;
        document.getElementById("resFecha").innerHTML = `üìÖ <strong>Fecha:</strong> ${fecha}`;
        document.getElementById("resHoraInicio").innerHTML = `‚è±Ô∏è <strong>Inici√≥:</strong> ${horaInicio_display}`;
        document.getElementById("resHoraFin").innerHTML = `‚úÖ <strong>Finaliz√≥:</strong> ${horaFin}`;
        
        document.getElementById("resPuntaje").innerHTML = 
            `Puntuaci√≥n: ${respuestasCorrectas} de ${totalPreguntas} correctas<br>` +
            `NOTA FINAL: ${notaFinal} / 5.0`;

        document.querySelector('button[onclick="mostrarResultado()"]').disabled = true;

        clearInterval(timer);
        document.getElementById("resultadoModal").style.display = "block";
        
        // 4. ENV√çO DE RESULTADO PARA EL DOCENTE (Guarda todos los campos)
        enviarResultadoAlDocente(codigo, nombre, grado, respuestasCorrectas, totalPreguntas, notaFinal, horaInicio_display, horaFin, fecha);
    }

    function cerrarModal() {
        document.getElementById("resultadoModal").style.display = "none";
    }

    /**
     * Guarda el resultado del Quizz en localStorage con todos los detalles.
     */
    function enviarResultadoAlDocente(codigoEstudiante, nombre, grado, puntuacion, total, nota, inicio, fin, fecha) {
        const storageKey = `resultado_quizz_${codigoEstudiante}`;
        
        const resultadoData = JSON.stringify({
            status: 'completado',
            nombre: nombre,
            grado: grado,
            puntuacion: `${puntuacion}/${total} correctas`,
            nota: `${nota} / 5.0`,
            fecha: fecha,
            horaInicio: inicio,
            horaFin: fin,
            timestamp: new Date().toLocaleString()
        });

        localStorage.setItem(storageKey, resultadoData);
    }


    // Hace que el temporizador sea arrastrable (se mantiene)
    function hacerTemporizadorMovible() {
        const el = document.getElementById("temporizador");
        let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

        el.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
            e.preventDefault();
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
            e.preventDefault();
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            el.style.top = (el.offsetTop - pos2) + "px";
            el.style.left = (el.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
            document.onmouseup = null;
            document.onmousemove = null;
        }
    }
</script>

</body>
</html>